<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Certificados - GRAVE</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cardo:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/print.css">
    
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar no-print">
        <div class="container">
            <a href="../index.html" class="navbar-brand">
                <div class="logo-placeholder">LOGO GRAVE</div>
                <span class="ml-2">Certificados Comunit√°rios</span>
            </a>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="../index.html" class="nav-link">In√≠cio</a>
                </li>
                <li class="nav-item">
                    <a href="evento.html" class="nav-link">Criar Evento</a>
                </li>
                <li class="nav-item">
                    <a href="gerador.html" class="nav-link active">Gerar Certificados</a>
                </li>
                <li class="nav-item">
                    <a href="templates.html" class="nav-link">Templates</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="container no-print">
        <nav class="breadcrumb">
            <div class="breadcrumb-item">
                <a href="../index.html">In√≠cio</a>
            </div>
            <div class="breadcrumb-item">
                <a href="evento.html">Evento</a>
            </div>
            <div class="breadcrumb-item">
                <a href="templates.html">Templates</a>
            </div>
            <div class="breadcrumb-item active">Gerar Certificados</div>
        </nav>
    </div>

    <!-- Steps Progress -->
    <div class="container no-print">
        <ol class="steps">
            <li class="step completed">
                <div class="step-number">1</div>
                <div class="step-title">Crie seu Evento/Curso</div>
            </li>
            <li class="step completed">
                <div class="step-number">2</div>
                <div class="step-title">Escolha o Template</div>
            </li>
            <li class="step active">
                <div class="step-number">3</div>
                <div class="step-title">Gere os Certificados</div>
            </li>
        </ol>
    </div><!-- Controls -->
    <div class="container no-print pb-4">
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">üìù Dados do Participante</h5>
                    </div>
                    <div class="card-body">
                        <form id="participanteForm">
                            <div class="form-group">
                                <label for="nomeParticipante" class="form-label required">Nome Completo</label>
                                <input type="text" 
                                       id="nomeParticipante" 
                                       name="nomeParticipante" 
                                       class="form-control" 
                                       placeholder="Nome completo do participante"
                                       data-validate="full-name"
                                       required>
                            </div>

                            <div class="form-group">
                                <label for="cpfParticipante" class="form-label required">CPF</label>
                                <input type="text" 
                                       id="cpfParticipante" 
                                       name="cpfParticipante" 
                                       class="form-control" 
                                       placeholder="000.000.000-00"
                                       data-mask="cpf"
                                       data-validate="cpf"
                                       required>
                            </div>

                            <div class="form-group">
                                <label for="numeroParticipante" class="form-label required">N√∫mero do Certificado</label>
                                <input type="text" 
                                       id="numeroParticipante" 
                                       name="numeroParticipante" 
                                       class="form-control" 
                                       placeholder="150425"
                                       data-validate="certificate-number"
                                       required>
                                <div class="form-text">N√∫mero sequencial √∫nico para este participante</div>
                            </div>

                            <div class="form-group">
                                <label for="observacoesParticipante" class="form-label">Observa√ß√µes</label>
                                <textarea id="observacoesParticipante" 
                                          name="observacoesParticipante" 
                                          class="form-control" 
                                          rows="2"
                                          placeholder="Observa√ß√µes espec√≠ficas (opcional)"></textarea>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="button" id="atualizarPreview" class="btn btn-primary">
                                    üîÑ Atualizar Preview
                                </button>
                                <button type="button" id="imprimirCertificado" class="btn btn-success">
                                    üñ®Ô∏è Imprimir Certificado
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Gerador Sequencial -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="card-title">‚ö° Gerador R√°pido</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="nomeBase" class="form-label">Nome Base</label>
                            <input type="text" 
                                   id="nomeBase" 
                                   class="form-control" 
                                   placeholder="Ex: Jo√£o Silva">
                            <div class="form-text">Nome que ser√° usado como base</div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <label for="numeroInicial" class="form-label">N√∫mero Inicial</label>
                                    <input type="number" 
                                           id="numeroInicial" 
                                           class="form-control" 
                                           value="1"
                                           min="1">
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label for="quantidade" class="form-label">Quantidade</label>
                                    <input type="number" 
                                           id="quantidade" 
                                           class="form-control" 
                                           value="1"
                                           min="1"
                                           max="50">
                                </div>
                            </div>
                        </div>

                        <button type="button" id="gerarSequencial" class="btn btn-outline-primary btn-block">
                            Gerar Sequ√™ncia
                        </button>
                    </div>
                </div>

                <!-- Resumo -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="card-title">üìä Resumo</h5>
                    </div>
                    <div class="card-body">
                        <div id="resumoConfiguracoes">
                            <p class="text-muted">Carregando dados...</p>
                        </div>
                    </div>
                </div>
            </div>
<div class="col-md-8">
                <div class="card certificate-preview">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">üëÅÔ∏è Preview do Certificado</h5>
                        <div>
                            <button type="button" id="zoomOut" class="btn btn-sm btn-outline-secondary">-</button>
                            <span id="zoomLevel" class="mx-2">60%</span>
                            <button type="button" id="zoomIn" class="btn btn-sm btn-outline-secondary">+</button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div id="certificateContainer" class="certificate-container" style="transform: scale(0.6); transform-origin: top left; overflow: hidden;">
                            
                            <!-- Primeira P√°gina: Certificado -->
                            <div id="certificatePage1" class="certificate certificate-page print-force-colors" style="width: 297mm; height: 210mm; background: white; position: relative; overflow: hidden; display: flex; flex-direction: column; font-family: 'Cardo', serif;">
                                
                                <!-- Header com design GRAVE real -->
                                <div class="certificate-header print-bg-primary" id="certificateHeader" style="background: linear-gradient(135deg, #FF3B3B 0%, #CC2C2C 100%); height: 85mm; color: white; display: flex; align-items: center; position: relative; padding: 0 30mm;">
                                    
                                    <!-- Pattern decorativo de fundo -->
                                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><defs><pattern id=\"diag\" patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\"><path d=\"M 0,10 l 10,-10 M -2.5,2.5 l 5,-5 M 7.5,12.5 l 5,-5\" stroke=\"%23ffffff\" stroke-width=\"0.5\" opacity=\"0.1\"/></pattern></defs><rect width=\"100\" height=\"100\" fill=\"url(%23diag)\"/></svg>') repeat; opacity: 0.3;"></div>
                                    
                                    <!-- Logo GRAVE -->
                                    <div style="width: 75mm; height: 75mm; background: white; border-radius: 12mm; display: flex; align-items: center; justify-content: center; margin-right: 20mm; position: relative; z-index: 3; border: 3mm solid white; box-shadow: 0 4mm 8mm rgba(0,0,0,0.2);">
                                        <div style="width: 60mm; height: 60mm; background: #FF3B3B; border-radius: 8mm; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 32px; position: relative;">
                                            <!-- S√≠mbolo do batimento card√≠aco -->
                                            <div style="width: 45mm; height: 45mm; border: 3mm solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative;">
                                                <svg width="30mm" height="20mm" viewBox="0 0 100 60" style="fill: white;">
                                                    <path d="M5,30 L15,30 L20,10 L30,50 L40,20 L50,40 L60,25 L70,35 L80,30 L95,30" stroke="white" stroke-width="6" fill="none"/>
                                                </svg>
                                            </div>
                                            <!-- S√≠mbolo m√©dico -->
                                            <div style="position: absolute; bottom: 8mm; color: white; font-size: 20px;">‚úö</div>
                                        </div>
                                    </div>
                                    
                                    <!-- T√≠tulo -->
                                    <div class="certificate-title print-white" style="position: relative; z-index: 3; flex-grow: 1; text-align: center; font-size: 28px; font-weight: bold; line-height: 1.3;">
                                        <span id="headerTitulo">Grupo de Resgate<br>e Apoio Volunt√°rio de Emerg√™ncia</span>
                                    </div>
                                </div>

                                <!-- Corpo do certificado -->
                                <div class="certificate-body" style="padding: 30mm 40mm; position: relative; flex-grow: 1; display: flex; flex-direction: column; justify-content: center;">
                                    
                                    <!-- Watermark GRAVE gigante -->
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 180mm; height: 180mm; opacity: 0.05; pointer-events: none; z-index: 1;">
                                        <div style="width: 100%; height: 100%; background: #FF3B3B; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 120px; font-weight: bold;">
                                            <svg width="120mm" height="80mm" viewBox="0 0 100 60" style="fill: currentColor;">
                                                <path d="M5,30 L15,30 L20,10 L30,50 L40,20 L50,40 L60,25 L70,35 L80,30 L95,30" stroke="currentColor" stroke-width="6" fill="none"/>
                                            </svg>
                                        </div>
                                    </div>
                                    
                                    <!-- Texto principal do certificado -->
                                    <div class="certificate-text print-text-justify" style="position: relative; z-index: 2; text-align: justify; font-size: 26px; line-height: 1.6; margin: 30mm 0; font-family: 'Cardo', serif; font-weight: 400;">
                                        CERTIFICAMOS QUE <span id="nomeDestaque" class="certificate-participant-name print-primary" style="font-size: 28px; font-weight: bold; color: #FF3B3B; text-transform: uppercase;">NOME DO PARTICIPANTE</span>,
                                        INSCRITO SOB O CPF N¬∫ <span id="cpfDestaque" class="print-black" style="font-weight: bold;">000.000.000-00</span> PARTICIPOU DO
                                        <span id="eventoDestaque" class="certificate-highlight print-black" style="font-weight: bold; text-transform: uppercase;">WORKSHOP PRIMEIROS SOCORROS PARA TODOS</span>, PROMOVIDO PELO
                                        GRAVE, <span id="dataTexto" class="print-black" style="font-weight: bold;">NO DIA 26 DE MAR√áO DE 2025</span>, <span id="localTexto" class="print-black" style="font-weight: bold;">NA APAE CACHOEIRINHA, QUE OPERA COM O CNPJ 88.928.080/0001-90</span>, FAZENDO TOTAL
                                        DE <span id="horasTexto" class="print-black" style="font-weight: bold;">4</span> HORAS.
                                    </div><!-- Assinaturas -->
                                    <div class="certificate-signatures" style="display: flex; justify-content: space-between; margin: 25mm 60mm 0; z-index: 3; position: relative;">
                                        <div class="certificate-signature" style="text-align: center; flex: 1; margin: 0 15mm;">
                                            <!-- Assinatura manuscrita -->
                                            <div style="height: 20mm; margin-bottom: 8mm; display: flex; align-items: center; justify-content: center;">
                                                <div style="font-style: italic; color: #666; font-size: 18px; transform: rotate(-2deg); font-family: 'Brush Script MT', cursive;">Liane Lima Wagner</div>
                                            </div>
                                            <div class="certificate-signature-line" style="width: 100%; height: 2px; background-color: #000; margin-bottom: 6mm;"></div>
                                            <div id="responsavel1Nome" class="certificate-signature-name" style="font-weight: bold; font-size: 18px; margin-bottom: 2mm;">Liane Wagner</div>
                                            <div id="responsavel1Cargo" class="certificate-signature-title" style="font-size: 16px;">Presidente</div>
                                        </div>

                                        <div id="assinatura2Container" class="certificate-signature" style="text-align: center; flex: 1; margin: 0 15mm;">
                                            <!-- Assinatura manuscrita -->
                                            <div style="height: 20mm; margin-bottom: 8mm; display: flex; align-items: center; justify-content: center;">
                                                <div style="font-style: italic; color: #666; font-size: 18px; transform: rotate(1deg); font-family: 'Brush Script MT', cursive;">Liane Lima Wagner</div>
                                            </div>
                                            <div class="certificate-signature-line" style="width: 100%; height: 2px; background-color: #000; margin-bottom: 6mm;"></div>
                                            <div id="responsavel2Nome" class="certificate-signature-name" style="font-weight: bold; font-size: 18px; margin-bottom: 2mm;">Liane Wagner</div>
                                            <div id="responsavel2Cargo" class="certificate-signature-title" style="font-size: 16px;">Coordenadora Operacional</div>
                                        </div>
                                        
                                        <!-- Terceira assinatura para cursos -->
                                        <div id="assinatura3Container" class="certificate-signature" style="text-align: center; flex: 1; margin: 0 15mm; display: none;">
                                            <!-- Assinatura manuscrita -->
                                            <div style="height: 20mm; margin-bottom: 8mm; display: flex; align-items: center; justify-content: center;">
                                                <div style="font-style: italic; color: #666; font-size: 18px; transform: rotate(-1deg); font-family: 'Brush Script MT', cursive;">Natielle</div>
                                            </div>
                                            <div class="certificate-signature-line" style="width: 100%; height: 2px; background-color: #000; margin-bottom: 6mm;"></div>
                                            <div id="responsavel3Nome" class="certificate-signature-name" style="font-weight: bold; font-size: 18px; margin-bottom: 2mm;">Natielle da Silva de √Åvila</div>
                                            <div id="responsavel3Cargo" class="certificate-signature-title" style="font-size: 16px;">Instrutora</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Footer com n√∫mero do certificado -->
                                <div class="certificate-footer" style="position: absolute; bottom: 15mm; left: 40mm; font-size: 18px; font-weight: bold; z-index: 3;">
                                    #<span id="numeroCertificado" class="certificate-number">150425</span>
                                </div>
                            </div>

                            <!-- Segunda P√°gina: Conte√∫do Program√°tico -->
                            <div id="certificatePage2" class="certificate-content-page print-page-break print-force-colors" style="width: 297mm; height: 210mm; padding: 40mm; box-sizing: border-box; position: relative; background: white; page-break-before: always; font-family: 'Cardo', serif;">
                                
                                <!-- T√≠tulo da segunda p√°gina -->
                                <div class="certificate-content-title print-primary" style="font-size: 28px; font-weight: bold; margin-bottom: 25mm; color: #FF3B3B;">
                                    Conte√∫do program√°tico:
                                </div>
                                
                                <!-- Lista de t√≥picos -->
                                <ul id="listaTopicos" class="certificate-content-list" style="list-style-type: disc; padding-left: 15mm; font-size: 20px; line-height: 1.6; font-weight: 500;">
                                    <li style="margin-bottom: 8mm;">Conceitos e fundamentos de Primeiros Socorros</li>
                                    <li style="margin-bottom: 8mm;">Suporte B√°sico de Vida (SBV)</li>
                                    <li style="margin-bottom: 8mm;">Primeiros Socorros em Emerg√™ncia Traum√°tica</li>
                                    <li style="margin-bottom: 8mm;">Primeiros Socorros em Emerg√™ncias Cl√≠nica</li>
                                </ul>

                                <!-- Informa√ß√µes da organiza√ß√£o -->
                                <div class="certificate-organization-info" style="position: absolute; bottom: 60mm; left: 40mm; right: 40mm; text-align: center; font-size: 20px; line-height: 1.8; font-weight: bold;">
                                    <span id="organizacaoInfo">GRAVE - Grupo de Resgate e Apoio Volunt√°rio de Emerg√™ncia.</span><br>
                                    CNPJ: <span id="cnpjInfo">12.827.677/0001-87</span><br>
                                    <span id="cidadeInfo">Cachoeirinha/RS</span>
                                </div>

                                <!-- N√∫mero do certificado na segunda p√°gina -->
                                <div class="certificate-content-number" style="position: absolute; bottom: 15mm; left: 40mm; font-size: 18px; font-weight: bold;">
                                    #<span id="numeroSegundaPagina">150425</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- Modal de Lista Sequencial -->
    <div id="modalListaSequencial" class="modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üìã Certificados Gerados</h5>
                    <button type="button" class="btn-close" data-modal-close="modalListaSequencial"></button>
                </div>
                <div class="modal-body">
                    <div id="listaSequencial">
                        <!-- Lista ser√° inserida aqui -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-modal-close="modalListaSequencial">
                        Fechar
                    </button>
                    <button type="button" id="imprimirTodos" class="btn btn-primary">
                        üñ®Ô∏è Imprimir Todos
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/components.js"></script>
    <script src="../assets/js/grave-data.js"></script>
    <script src="../assets/js/certificate.js"></script>
    <script>
        $(document).ready(function() {
            'use strict';
            
            let zoomLevel = 60; // Zoom inicial reduzido para caber na tela
            
            // Verificar se todos os dados est√£o dispon√≠veis
            function verificarDadosCompletos() {
                const evento = GRAVE.Storage.get('evento');
                const template = GRAVE.Storage.get('template_selecionado');
                
                if (!evento || !evento.nomeEvento) {
                    GRAVE.Notification.error('Dados do evento n√£o encontrados');
                    setTimeout(() => window.location.href = 'evento.html', 2000);
                    return false;
                }
                
                if (!template) {
                    GRAVE.Notification.error('Nenhum template selecionado');
                    setTimeout(() => window.location.href = 'templates.html', 2000);
                    return false;
                }
                
                return true;
            }
            
            // Aplicar layout espec√≠fico baseado no tipo de evento
            function aplicarLayoutEvento(tipoEvento) {
                const $header = $('#certificateHeader');
                const $signatures = $('.certificate-signatures');
                const $assinatura3 = $('#assinatura3Container');
                
                if (tipoEvento === 'curso') {
                    // Layout para cursos (fundo cinza, 3 assinaturas)
                    $header.css('background', 'linear-gradient(135deg, #4A4A4A 0%, #2A2A2A 100%)');
                    
                    // Ajustar assinaturas para 3 colunas
                    $signatures.css('margin', '25mm 40mm 0');
                    $('.certificate-signature').css('margin', '0 8mm');
                    $assinatura3.show();
                    
                    // Atualizar watermark
                    $('.certificate-body > div:first-child > div').css('background', '#4A4A4A');
                    
                } else {
                    // Layout para workshops (fundo vermelho, 2 assinaturas)
                    $header.css('background', 'linear-gradient(135deg, #FF3B3B 0%, #CC2C2C 100%)');
                    
                    // Ajustar assinaturas para 2 colunas
                    $signatures.css('margin', '25mm 60mm 0');
                    $('.certificate-signature').css('margin', '0 15mm');
                    $assinatura3.hide();
                    
                    // Atualizar watermark
                    $('.certificate-body > div:first-child > div').css('background', '#FF3B3B');
                }
            }// Carregar dados no certificado
            function carregarDadosCertificado() {
                const evento = GRAVE.Storage.get('evento');
                const organizacao = getGraveData(); // Usar dados fixos do GRAVE
                
                // Aplicar layout baseado no tipo de evento
                if (evento && evento.tipoEvento) {
                    aplicarLayoutEvento(evento.tipoEvento);
                }
                
                // Dados da organiza√ß√£o GRAVE (fixos)
                if (organizacao) {
                    $('#headerTitulo').text(organizacao.nomeExibicao);
                    $('#organizacaoInfo').text(`${organizacao.nomeCompleto}.`);
                    $('#cnpjInfo').text(organizacao.cnpj);
                    $('#cidadeInfo').text(organizacao.endereco.cidadeEstado);
                    
                    // Respons√°veis fixos do GRAVE
                    $('#responsavel1Nome').text(organizacao.responsaveis.presidente.nome);
                    $('#responsavel1Cargo').text(organizacao.responsaveis.presidente.cargo);
                    $('#responsavel2Nome